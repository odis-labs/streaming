<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Source (streaming.Streaming.Source)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 1.5.2"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> â€“ <a href="../../index.html">streaming</a> &#x00BB; <a href="../index.html">Streaming</a> &#x00BB; Source</nav><h1>Module <code>Streaming.Source</code></h1><p>Module with defintions for sources.</p><p>Elements are pulled from a source when needed. A source can have an internal state that will be lazily initialized when (and if) a consumer requests elements. The internal state will be safely disposed when the source runs out of elements, when the consumer terminates, or if an exception is raised at any point in the streaming pipeline.</p><p>Sources are a great way to define decoupled producers that can be consumed with <a href="../Stream/index.html#val-from"><code>Stream.from</code></a>.</p><p>Sources are &quot;single shot&quot; and will haver their input exhausted by most operations. Consider <a href="../Sink/index.html#val-buffer"><span>buffering</span></a> sources if you need to reuse their input.</p><nav class="toc"><ul><li><a href="#creating-a-source">Creating a source</a></li><li><a href="#zipping-sources">Zipping sources</a></li><li><a href="#transforming-a-source">Transforming a source</a></li><li><a href="#consuming-a-source">Consuming a source</a></li><li><a href="#resource-handling">Resource handling</a></li></ul></nav></header><dl><dt class="spec type" id="type-t"><a href="#type-t" class="anchor"></a><code><span class="keyword">type</span> <span>+'a t</span></code><code> = <span><span class="type-var">'a</span> <a href="../index.html#type-source">source</a></span></code></dt><dd><p>The type for sources that produce elements of type <code>'a</code>.</p></dd></dl><section><header><h2 id="creating-a-source"><a href="#creating-a-source" class="anchor"></a>Creating a source</h2><p>Implementing your own custom sources enables access to many useful operations. The most flexible way to create a source is with the <a href="index.html#val-make"><code>Source.make</code></a> function.</p><p>The following example creates a source that counts down to zero:</p><pre><code class="ml">let countdown n =
  let init () = n in
  let pull i =
    if i = 0 then None
    else Some (i, i - 1)) in
  Source.make ~init ~pull</code></pre><p>Alternatively, existing <a href="index.html#val-list"><code>list</code></a>/<a href="index.html#val-array"><code>array</code></a>/<a href="index.html#val-seq"><code>seq</code></a>/<a href="index.html#val-string"><code>string</code></a> sources, or others listed below, can be used.</p></header><dl><dt class="spec value" id="val-empty"><a href="#val-empty" class="anchor"></a><code><span class="keyword">val</span> empty : <span><span class="type-var">'a</span> <a href="index.html#type-t">t</a></span></code></dt><dd><p><code>zero</code> is an empty source.</p></dd></dl><dl><dt class="spec value" id="val-single"><a href="#val-single" class="anchor"></a><code><span class="keyword">val</span> single : <span class="type-var">'a</span> <span>&#45;&gt;</span> <span><span class="type-var">'a</span> <a href="index.html#type-t">t</a></span></code></dt><dd><p><code>single a</code> is a source with a single element <code>a</code>.</p></dd></dl><dl><dt class="spec value" id="val-list"><a href="#val-list" class="anchor"></a><code><span class="keyword">val</span> list : <span><span class="type-var">'a</span> list</span> <span>&#45;&gt;</span> <span><span class="type-var">'a</span> <a href="index.html#type-t">t</a></span></code></dt><dd><p><code>list items</code> is a source with all elements from the <code>items</code> list.</p></dd></dl><dl><dt class="spec value" id="val-seq"><a href="#val-seq" class="anchor"></a><code><span class="keyword">val</span> seq : <span><span class="type-var">'a</span> Stdlib.Seq.t</span> <span>&#45;&gt;</span> <span><span class="type-var">'a</span> <a href="index.html#type-t">t</a></span></code></dt><dd><p><code>seq items</code> is a source with all elements from the <code>items</code> sequence.</p></dd></dl><dl><dt class="spec value" id="val-array"><a href="#val-array" class="anchor"></a><code><span class="keyword">val</span> array : <span><span class="type-var">'a</span> array</span> <span>&#45;&gt;</span> <span><span class="type-var">'a</span> <a href="index.html#type-t">t</a></span></code></dt><dd><p><code>array items</code> is a source with all elements from the <code>items</code> array.</p></dd></dl><dl><dt class="spec value" id="val-string"><a href="#val-string" class="anchor"></a><code><span class="keyword">val</span> string : string <span>&#45;&gt;</span> <span>char <a href="index.html#type-t">t</a></span></code></dt><dd><p><code>string str</code> is a source with all characters from the <code>str</code> string.</p></dd></dl><dl><dt class="spec value" id="val-bytes"><a href="#val-bytes" class="anchor"></a><code><span class="keyword">val</span> bytes : bytes <span>&#45;&gt;</span> <span>char <a href="index.html#type-t">t</a></span></code></dt><dd><p><code>bytes b</code> is a source with all characters from the <code>b</code> bytes.</p></dd></dl><dl><dt class="spec value" id="val-queue"><a href="#val-queue" class="anchor"></a><code><span class="keyword">val</span> queue : <span><span class="type-var">'a</span> Stdlib.Queue.t</span> <span>&#45;&gt;</span> <span><span class="type-var">'a</span> <a href="index.html#type-t">t</a></span></code></dt><dd><p><code>queue q</code> is a source with all characters from the <code>q</code> queue.</p></dd></dl><dl><dt class="spec value" id="val-generate"><a href="#val-generate" class="anchor"></a><code><span class="keyword">val</span> generate : <span>len:int</span> <span>&#45;&gt;</span> <span>(int <span>&#45;&gt;</span> <span class="type-var">'a</span>)</span> <span>&#45;&gt;</span> <span><span class="type-var">'a</span> <a href="index.html#type-t">t</a></span></code></dt><dd><p><code>generate ~len f</code> generates a source of length <code>len</code> mapping each index to an element with <code>f</code>.</p></dd></dl><dl><dt class="spec value" id="val-count"><a href="#val-count" class="anchor"></a><code><span class="keyword">val</span> count : int <span>&#45;&gt;</span> <span>int <a href="index.html#type-t">t</a></span></code></dt><dd><p><code>count n</code> is an infinite source with integers starting from <code>n</code>.</p></dd></dl><dl><dt class="spec value" id="val-iterate"><a href="#val-iterate" class="anchor"></a><code><span class="keyword">val</span> iterate : <span class="type-var">'a</span> <span>&#45;&gt;</span> <span>(<span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'a</span>)</span> <span>&#45;&gt;</span> <span><span class="type-var">'a</span> <a href="index.html#type-t">t</a></span></code></dt><dd><p><code>iterate x f</code> is an infinite source where the first item is calculated by applying <code>f</code> to <code>x</code>, the second item by applying the function on the previous result and so on.</p></dd></dl><dl><dt class="spec value" id="val-unfold"><a href="#val-unfold" class="anchor"></a><code><span class="keyword">val</span> unfold : <span class="type-var">'s</span> <span>&#45;&gt;</span> <span>(<span class="type-var">'s</span> <span>&#45;&gt;</span> <span><span>(<span class="type-var">'a</span> * <span class="type-var">'s</span>)</span> option</span>)</span> <span>&#45;&gt;</span> <span><span class="type-var">'a</span> <a href="index.html#type-t">t</a></span></code></dt><dd><p><code>unfold seed next</code> is a finite source created from a <code>seed</code> state and a function that produces elements and an updated state.</p></dd></dl><dl><dt class="spec value" id="val-make"><a href="#val-make" class="anchor"></a><code><span class="keyword">val</span> make : <span>init:<span>(unit <span>&#45;&gt;</span> <span class="type-var">'s</span>)</span></span> <span>&#45;&gt;</span> <span>pull:<span>(<span class="type-var">'s</span> <span>&#45;&gt;</span> <span><span>(<span class="type-var">'a</span> * <span class="type-var">'s</span>)</span> option</span>)</span></span> <span>&#45;&gt;</span> <span>?&#8288;stop:<span>(<span class="type-var">'s</span> <span>&#45;&gt;</span> unit)</span></span> <span>&#45;&gt;</span> unit <span>&#45;&gt;</span> <span><span class="type-var">'a</span> <a href="index.html#type-t">t</a></span></code></dt><dd><p><code>make ~init ~pull ~stop ()</code> is a value source created from the <code>init</code>, <code>pull</code> and <code>stop</code>. This function is similar to <a href="index.html#val-unfold"><code>unfold</code></a> but without lazy state initialization and state termination functions.</p><p><b>Note</b>: For better performance, it is recommended that the <code>pull</code> function caches the termination condition in case it is expensive.</p></dd></dl></section><section><header><h2 id="zipping-sources"><a href="#zipping-sources" class="anchor"></a>Zipping sources</h2></header><dl><dt class="spec value" id="val-zip_with"><a href="#val-zip_with" class="anchor"></a><code><span class="keyword">val</span> zip_with : <span>(<span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'b</span> <span>&#45;&gt;</span> <span class="type-var">'c</span>)</span> <span>&#45;&gt;</span> <span><span class="type-var">'a</span> <a href="index.html#type-t">t</a></span> <span>&#45;&gt;</span> <span><span class="type-var">'b</span> <a href="index.html#type-t">t</a></span> <span>&#45;&gt;</span> <span><span class="type-var">'c</span> <a href="index.html#type-t">t</a></span></code></dt><dd><p><code>zip_with f src1 src2</code> is a source that pulls elements from <code>src1</code> and <code>src2</code> one by one, combining them with <code>f</code>.</p></dd></dl><dl><dt class="spec value" id="val-zip"><a href="#val-zip" class="anchor"></a><code><span class="keyword">val</span> zip : <span><span class="type-var">'a</span> <a href="index.html#type-t">t</a></span> <span>&#45;&gt;</span> <span><span class="type-var">'b</span> <a href="index.html#type-t">t</a></span> <span>&#45;&gt;</span> <span><span>(<span class="type-var">'a</span> * <span class="type-var">'b</span>)</span> <a href="index.html#type-t">t</a></span></code></dt><dd><p><code>zip src1 src2</code> is a source of pairs with elements elements pulled from <code>src1</code> and <code>src2</code> one by one.</p><p>Equivalent to <code>zip_with (fun x y -&gt; (x, y)) src1 src2</code>.</p></dd></dl></section><section><header><h2 id="transforming-a-source"><a href="#transforming-a-source" class="anchor"></a>Transforming a source</h2><p><b>Note</b>: Instead of applying the transformation functions at the source, consider using <a href="../Stream/index.html#val-from"><code>Stream.from</code></a> or defining your compuation as a <a href="../Flow/index.html"><code>Flow</code></a> to make it reusable.</p></header><dl><dt class="spec value" id="val-map"><a href="#val-map" class="anchor"></a><code><span class="keyword">val</span> map : <span>(<span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'b</span>)</span> <span>&#45;&gt;</span> <span><span class="type-var">'a</span> <a href="index.html#type-t">t</a></span> <span>&#45;&gt;</span> <span><span class="type-var">'b</span> <a href="index.html#type-t">t</a></span></code></dt><dd><p>A source with all elements transformed with a mapping function.</p></dd></dl><dl><dt class="spec value" id="val-filter"><a href="#val-filter" class="anchor"></a><code><span class="keyword">val</span> filter : <span>(<span class="type-var">'a</span> <span>&#45;&gt;</span> bool)</span> <span>&#45;&gt;</span> <span><span class="type-var">'a</span> <a href="index.html#type-t">t</a></span> <span>&#45;&gt;</span> <span><span class="type-var">'a</span> <a href="index.html#type-t">t</a></span></code></dt><dd><p>A source that includes only the elements that satisfy a predicate.</p></dd></dl><dl><dt class="spec value" id="val-filter_map"><a href="#val-filter_map" class="anchor"></a><code><span class="keyword">val</span> filter_map : <span>(<span class="type-var">'a</span> <span>&#45;&gt;</span> <span><span class="type-var">'b</span> option</span>)</span> <span>&#45;&gt;</span> <span><span class="type-var">'a</span> <a href="index.html#type-t">t</a></span> <span>&#45;&gt;</span> <span><span class="type-var">'b</span> <a href="index.html#type-t">t</a></span></code></dt><dd><p><code>filter_map f source</code> applies <code>f</code> to every element <code>x</code> of source, discarding it if <code>f x</code> produces <code>None</code>, and keeping the transformed value otherwise.</p></dd></dl><dl><dt class="spec value" id="val-take"><a href="#val-take" class="anchor"></a><code><span class="keyword">val</span> take : int <span>&#45;&gt;</span> <span><span class="type-var">'a</span> <a href="index.html#type-t">t</a></span> <span>&#45;&gt;</span> <span><span class="type-var">'a</span> <a href="index.html#type-t">t</a></span></code></dt><dd><p>Take first <code>n</code> elements from the source and discard the rest.</p></dd></dl><aside><p>Similar to <a href="index.html#val-take"><code>take</code></a> but takes the last <code>n</code> elements.</p></aside><dl><dt class="spec value" id="val-take_while"><a href="#val-take_while" class="anchor"></a><code><span class="keyword">val</span> take_while : <span>(<span class="type-var">'a</span> <span>&#45;&gt;</span> bool)</span> <span>&#45;&gt;</span> <span><span class="type-var">'a</span> <a href="index.html#type-t">t</a></span> <span>&#45;&gt;</span> <span><span class="type-var">'a</span> <a href="index.html#type-t">t</a></span></code></dt><dd><p>Take first elements from the source that satisfy a predicate and discard the rest.</p></dd></dl><dl><dt class="spec value" id="val-drop"><a href="#val-drop" class="anchor"></a><code><span class="keyword">val</span> drop : int <span>&#45;&gt;</span> <span><span class="type-var">'a</span> <a href="index.html#type-t">t</a></span> <span>&#45;&gt;</span> <span><span class="type-var">'a</span> <a href="index.html#type-t">t</a></span></code></dt><dd><p>Drop first <code>n</code> elements from the source and keep the rest.</p></dd></dl><aside><p>Similar to <a href="index.html#val-drop"><code>drop</code></a> but drops the last <code>n</code> elements.</p></aside><dl><dt class="spec value" id="val-drop_while"><a href="#val-drop_while" class="anchor"></a><code><span class="keyword">val</span> drop_while : <span>(<span class="type-var">'a</span> <span>&#45;&gt;</span> bool)</span> <span>&#45;&gt;</span> <span><span class="type-var">'a</span> <a href="index.html#type-t">t</a></span> <span>&#45;&gt;</span> <span><span class="type-var">'a</span> <a href="index.html#type-t">t</a></span></code></dt><dd><p>Drpo first elements from the source that satisfy a predicate and keep the rest.</p></dd></dl></section><section><header><h2 id="consuming-a-source"><a href="#consuming-a-source" class="anchor"></a>Consuming a source</h2><p>Many consumers are available in the <a href="../Sink/index.html"><code>Sink</code></a> module. You can consume any source using a sink with:</p><pre><code class="ml">let source = Source.iota 10 in
source
|&gt; Stream.from
|&gt; Stream.into Sink.last</code></pre><p>Alternatively use the source consumers below for simple operations.</p></header><dl><dt class="spec value" id="val-fold"><a href="#val-fold" class="anchor"></a><code><span class="keyword">val</span> fold : <span>(<span class="type-var">'r</span> <span>&#45;&gt;</span> <span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'r</span>)</span> <span>&#45;&gt;</span> <span class="type-var">'r</span> <span>&#45;&gt;</span> <span><span class="type-var">'a</span> <a href="index.html#type-t">t</a></span> <span>&#45;&gt;</span> <span class="type-var">'r</span></code></dt><dd><p><code>fold step init source</code> reduces the values of <code>source</code> with the <code>step</code> function, starting with <code>init</code>.</p><p>If the <code>step</code> function raises an exception, the source will be properly terminated.</p></dd></dl><dl><dt class="spec value" id="val-len"><a href="#val-len" class="anchor"></a><code><span class="keyword">val</span> len : <span><span class="type-var">'a</span> <a href="index.html#type-t">t</a></span> <span>&#45;&gt;</span> int</code></dt><dd><p><code>len src</code> is the count of elements in <code>src</code>.</p></dd></dl><dl><dt class="spec value" id="val-each"><a href="#val-each" class="anchor"></a><code><span class="keyword">val</span> each : <span>(<span class="type-var">'a</span> <span>&#45;&gt;</span> unit)</span> <span>&#45;&gt;</span> <span><span class="type-var">'a</span> <a href="index.html#type-t">t</a></span> <span>&#45;&gt;</span> unit</code></dt><dd><p><code>each f src</code> applies an effectful function <code>f</code> to all elements in <code>src</code>.</p></dd></dl><dl><dt class="spec value" id="val-next"><a href="#val-next" class="anchor"></a><code><span class="keyword">val</span> next : <span><span class="type-var">'a</span> <a href="index.html#type-t">t</a></span> <span>&#45;&gt;</span> <span><span>(<span class="type-var">'a</span> * <span><span class="type-var">'a</span> <a href="index.html#type-t">t</a></span>)</span> option</span></code></dt><dd><p><code>next src</code> is <code>Some (x, rest)</code> where <code>x</code> is the first element of <code>src</code> and <code>rest</code> is <code>src</code> without <code>x</code>; or <code>None</code>, if <code>src</code> is empty.</p><p><b>Warning:</b> If <code>rest</code> is produced, it is required to either consume it or manually <a href="index.html#val-dispose"><span>dispose</span></a> its resources. Not doing so might lead to resource leaks.</p></dd></dl></section><section><header><h2 id="resource-handling"><a href="#resource-handling" class="anchor"></a>Resource handling</h2></header><dl><dt class="spec value" id="val-dispose"><a href="#val-dispose" class="anchor"></a><code><span class="keyword">val</span> dispose : <span><span class="type-var">'a</span> <a href="index.html#type-t">t</a></span> <span>&#45;&gt;</span> unit</code></dt><dd><p><code>dispose source</code> forces the termination of the source state. This function is useful in situations when a leftover source is produced in <a href="../Stream/index.html#val-run"><code>Stream.run</code></a>.</p><p><b>Note:</b> If the source is not already initialized, calling this function will first initialize its state before it is terminated.</p></dd></dl></section></div></body></html>